---
title: "Next.js+TypeScriptç’°å¢ƒã§Jestã‚’è¨­å®šã—ã¦ãƒ†ã‚¹ãƒˆã‚’ã™ã‚‹"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nextjs", "typescript", "jest"]
published: true
---


Next.js+TypeScriptç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆè¨­å®šã§ã™ã€‚
ãƒ†ã‚¹ãƒˆã¯react-domã«åŒå°ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã ã‘ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
DOMã‚¤ãƒ™ãƒ³ãƒˆã«åå¿œã™ã‚‹ã ã‘ã®ç°¡å˜ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆã‚’ã—ã¦ã¿ã¾ã™ã€‚

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install --save-dev jest @types/jest ts-jest
```

## è¨­å®š

`jest.config.json`

```javascript
module.exports = {
    preset: 'ts-jest',
    globals: {
        'ts-jest': {
            tsconfig: '<rootDir>/spec/tsconfig.json'
        }
    }
}
```

`spec/tsconfig.json`

```json
{
  "extends": "../tsconfig.json",
  "include": ["./**/*"],
  "compilerOptions": {
    "jsx": "react-jsx"
  }
}
```

Next.jsã®`jsx`ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯`preserve`ã¨ãªã£ã¦ã„ã¾ã™ã€‚
ã“ã‚Œã‚’ãƒ†ã‚¹ãƒˆç”¨ã¯`react-jsx`ã«è¨­å®šã—ã¾ã™ã€‚

## react-jsx

React17ã‹ã‚‰å…¥ã£ãŸæ–°ã—ã„JSXå¤‰æ›ã§ã™ã€‚

https://ja.reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html

https://zenn.dev/uhyo/articles/react17-new-jsx-transform

TypeScriptã¯4.1ã‹ã‚‰`jsx`ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚ªãƒ—ã‚·ãƒ§ãƒ³

- `react-jsx`
- `react-jsx-dev`

ã®è¿½åŠ ã§å¯¾å¿œã•ã‚Œã¦ã„ã¾ã™ã€‚

https://devblogs.microsoft.com/typescript/announcing-typescript-4-1/#react-17-jsx-factories

https://github.com/microsoft/TypeScript/pull/39199

ã“ã‚Œã«ã‚ˆã‚Šã„ã¤ã‚‚ã®importæ–‡ãŒå¿…è¦ãªããªã‚Šã¾ã—ãŸã€‚
Next.jsç’°å¢ƒã§`jsx`ãŒ`preserve`ã§ã‚ã£ã¦ã‚‚ã€ãƒ†ã‚¹ãƒˆç”¨ã«Babelã‚’ä½¿ç”¨ã—ãªãã¦ã‚‚è‰¯ã„ã®ã§ã™ã€‚

```typescript
// ã•ã‚ˆãªã‚‰
import React from 'react'
```

## ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆã¨ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

ã“ã®ã‚ˆã†ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

```tsx
import { useState } from 'react'

export const Ababababa = () => {

    const [title, setTitle] = useState<string>('Stay Calm')

    const onMouseEnter = () => { setTitle('ã‚ã°ã°ã°ã°') }
    const onMouseLeave = () => { setTitle('ã‚ã°ã£') }

    return (
        <h1 {...{onMouseEnter,onMouseLeave}}>
            {title}
        </h1>
    )
}
```

ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã«ã—ã¾ã™ã€‚

```tsx
import { render } from 'react-dom'
import { act } from 'react-dom/test-utils'
import { Ababababa } from '../../components/Ababababa'

describe('ã‚ã°ã°ã°ã°', () => {
    let container: HTMLDivElement
    beforeEach(() => {
        document.body.appendChild(container = document.createElement('div'))
    })
    afterEach(() => {
        document.body.removeChild(container)
    })

    it('should Stay Calm', () => {
        render(<Ababababa />, container)
        expect(container.innerHTML).toMatchSnapshot()
    })

    it('should ã‚ã°ã°ã°ã°', () => {
        act(() => {
            render(<Ababababa />, container)
        })
        act(() => {
            container.dispatchEvent(new MouseEvent('mouseover', { bubbles: true }))
            container.children[0].dispatchEvent(new MouseEvent('mouseover', { bubbles: true, cancelable: true }))
        })
        expect(container.innerHTML).toMatchSnapshot()
    })

    it('should ã‚ã°ã£', () => {
        act(() => {
            render(<Ababababa />, container)
        })
        act(() => {
            container.children[0].dispatchEvent(new MouseEvent('mouseout', { bubbles: true }))
            container.dispatchEvent(new MouseEvent('mouseout', { bubbles: true }))
        })
        expect(container.innerHTML).toMatchSnapshot()
    })
})
```

Reactã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä»•æ§˜ã®é–¢ä¿‚ã§ `onMouseEnter`, `onMouseLeave`, ã«å¯¾ã—ã¦ `mouseover`, `mouseout` ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«ã—ã¦ã„ã¾ã™ã€‚ï¼ˆã“ã“ã§ã¯ã¾ã‚Šã¾ã—ãŸï¼‰

https://ja.reactjs.org/docs/handling-events.html

https://ja.reactjs.org/docs/events.html

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãŒä½œæˆã•ã‚Œã‚‹ã®ã§ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

```
// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`ã‚ã°ã°ã°ã° should Stay Calm 1`] = `"<h1>Stay Calm</h1>"`;

exports[`ã‚ã°ã°ã°ã° should ã‚ã°ã£ 1`] = `"<h1>ã‚ã°ã£</h1>"`;

exports[`ã‚ã°ã°ã°ã° should ã‚ã°ã°ã°ã° 1`] = `"<h1>ã‚ã°ã°ã°ã°</h1>"`;
```

æœŸå¾…é€šã‚Šã®å‡ºåŠ›ãªã®ã§ã€æ¬¡å›ã®ãƒ†ã‚¹ãƒˆã‹ã‚‰ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã«å¯¾ã™ã‚‹å‡ºåŠ›ãŒã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¨æ¯”è¼ƒã•ã‚Œæ­£ã—ã„ã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚

## Next.jsã«ãŠã‘ã‚‹ãƒ†ã‚¹ãƒˆ

pagesä»¥ä¸‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ãƒ†ã‚¹ãƒˆãŒé›£ã—ããªã‚ŠãŒã¡ãªã®ã§ã€éƒ¨å“å˜ä½ã§å˜ä½“ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã—ã€ãªã‚‹ã¹ãæ©Ÿèƒ½ã‚’ä¿è¨¼ã—ã¦ã„ãå½¢ã«ãªã‚Šãã†ã§ã™ã€‚
